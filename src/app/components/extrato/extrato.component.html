<app-top-bar titulo="Extrato"></app-top-bar>

<app-select-planilha></app-select-planilha>

<div class="w3-row">
    <div class="w3-col l6">

        <!-- FILTROS 
        <form #form [formGroup]="group" autocomplete="off" (ngSubmit)="filtrar()">
            <div style="display: flex; width: 100%;">
                <div style="width: 80%;">
                    <mat-form-field>
                        <mat-label>Filtrar por Label</mat-label>
                        <input type=" text" placeholder="label" matInput formControlName="labels"
                            [matAutocomplete]="auto">
                        <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
                            <mat-option *ngFor="let label of filteredLabels" [value]="label.descricao">
                                {{label.descricao}}
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                </div>
                <div style="width: 20%;">
                    <button mat-mini-fab color="basic" aria-label="Filtrar extrato" type="submit">
                        <mat-icon>filter_alt</mat-icon>
                    </button>
                    <button mat-mini-fab color="basic" aria-label="Limpar filtros" type="button"
                        (click)="findExtrato(); form.reset()">
                        <mat-icon>close</mat-icon>
                    </button>
                </div>
            </div>
        </form>
-->
        <!-- SALDOS TOTAIS -->
        <div class="w3-row" style="margin-top: 15px; margin-left: 15px;">
            <div class="select-container w3-col s4">
            </div>
            <div class="select-container w3-col s4" style="text-align: right; padding-right: 24px;">
                <label class="mini-label">Saldo Atual</label>
                <span style="font-size: 15px;">
                    R$ {{saldoAtual | number: '1.2-2'}}
                </span>
            </div>
            <div class="select-container w3-col s4" style="text-align: right; padding-right: 50px;">
                <label class="mini-label">Saldo Previsto</label>
                <span style="font-size: 15px;">
                    R$ {{saldoPrevisto| number: '1.2-2'}}
                </span>
            </div>
        </div>

        <mat-accordion class="example-headers-align" multi>
            <mat-expansion-panel *ngFor="let conta of extrato; let indexConta = index"
                [expanded]="isExpanded(conta.id)">
                <mat-expansion-panel-header (click)="expand(conta)">
                    <mat-panel-title>
                        <span class="header">
                            {{conta.descricao}}
                        </span>
                    </mat-panel-title>
                    <mat-panel-description>
                        <span class="header right">
                            R$ {{conta.saldoEfetivado | number: '1.2-2'}}
                        </span>
                        <span class="header right">
                            R$ {{conta.saldoPrevisto | number: '1.2-2'}}
                        </span>
                    </mat-panel-description>
                </mat-expansion-panel-header>

                <table mat-table [dataSource]="conta.lancamentos" class="mat-elevation-z8" style="width: 100%" matSort>

                    <ng-container matColumnDef="data">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header
                            (click)="sortBy(indexConta, conta.lancamentos, 'data')"> Data
                        </th>
                        <td mat-cell *matCellDef="let item" (click)="editar(item.id)"> {{item.data | date:'dd/MM'}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="descricao">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header
                            (click)="sortBy(indexConta, conta.lancamentos, 'descricao')">
                            Descrição </th>
                        <td mat-cell *matCellDef="let item" (click)="editar(item.id)">
                            {{item.descricao}}
                            <span class="extratoLabel" *ngFor="let l of item.labels">{{l}}</span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="valor">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header style="text-align: right;"
                            (click)="sortBy(indexConta, conta.lancamentos, 'valor')"> Valor </th>
                        <td mat-cell *matCellDef="let item" (click)="editar(item.id)" class="valor"
                            [ngStyle]="{'color':item.valor < 0 ? 'red' : 'black' }"> {{item.valor | number: '1.2-2'}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="fixo">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header
                            (click)="sortBy(indexConta, conta.lancamentos, 'fixo')">Fixo</th>
                        <td mat-cell *matCellDef="let item">
                            <mat-checkbox #fixo [checked]="item.fixo" (click)="update('fixo', fixo, item)"></mat-checkbox>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="concluido">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header
                            (click)="sortBy(indexConta, conta.lancamentos, 'concluido')">Concluído</th>
                        <td mat-cell *matCellDef="let item">
                            <mat-checkbox #concluido [checked]="item.concluido"
                                (click)="update('concluido', concluido, item)"></mat-checkbox>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>

            </mat-expansion-panel>
        </mat-accordion>
    </div>

    <div class="w3-col l6">
        <app-analise-categoria></app-analise-categoria>
    </div>

</div>